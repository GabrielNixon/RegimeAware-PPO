# Financial Analysis Repository

This repository contains a comprehensive financial analysis of asset returns, portfolio optimization, and risk assessment, using historical financial data primarily sourced from "Finance Portfolio 2.csv," provided by Professor Aswath Damodaran of New York University (NYU).

---

## Dataset Overview

### Finance Portfolio.csv

The primary dataset, "Finance Portfolio 2.csv," provided by Professor Aswath Damodaran from NYU, contains historical annual returns for various asset classes, including:

* Equities (e.g., S&P 500, Small Cap)
* Bonds (e.g., 10-Year Treasury, Baa Corporate)
* Real Estate
* Commodities (e.g., Gold)
* Risk-free assets (e.g., T-Bills)

The dataset spans extensive historical periods, capturing multiple economic cycles and critical financial stress periods (1931, 1974, 1987, 2001, 2008, and 2020), making it particularly suitable for analyzing asset behavior under varied market conditions and for robust portfolio risk management strategies.

### cleaned_real_asset_returns.csv

A cleaned and processed version of the original dataset, optimized for computational analysis. Generated by running the script `cleaned_real_asset_returns.py`, it contains standardized and formatted returns data suitable for analytical tasks.

---

## Python Scripts

### Standard Financial Analysis Scripts

* **`cleaned_real_asset_returns.py`**: Script for cleaning and processing raw data.
* **`sharpe_stress_analysis.py`**: Computes Sharpe ratios for assets during stress and non-stress periods.
* **`rolling_sharpe_analysis.py`**: Calculates rolling Sharpe ratios over 2-, 5-, and 10-year windows.
* **`centered_window_analysis.py`**: Performs Sharpe ratio calculations around stress years using centered windows.
* **`bootstrap_ci.py`**: Generates bootstrap confidence intervals for cumulative returns using Monte Carlo simulations.
* **`resilience_analysis.py`**: Computes resilience scores based on volatility, cumulative return, and CAGR.
* **`pca_resilience.py`**: Applies PCA to derive resilience scores for assets.
* **`portfolio_optimization.py`**: Optimizes asset portfolio based on maximizing Sharpe ratio.
* **`sortino_optimization.py`**: Performs portfolio optimization focusing on maximizing Sortino ratio.
* **`factor_attribution.py`**: Conducts factor attribution analysis using the Fama-French + Momentum factors.
* **`drawdown_analysis.py`**: Calculates the maximum historical drawdown for each asset.
* **`rolling_factor_analysis.py`**: Calculates rolling betas and performs statistical diagnostic tests on factor regression residuals.

### Regime-Aware AI Extensions

* **`regime_features.py`**: Extracts regime-related features such as drawdown, volatilities, spreads.
* **`regime_clustering.py`**: Applies KMeans, GMM, and HMM for unsupervised regime detection.
* **`regime_classification.py`**: Uses Autoencoder, Random Forest, and XGBoost for supervised regime classification.
* **`monte_carlo_simulation.py`**: Runs regime-aware Monte Carlo simulation with static transition probabilities.
* **`enhanced_monte_carlo.py`**: Extends Monte Carlo simulation using macroeconomic inputs for dynamic regime modeling.
* **`regime_rl_env.py`**: Custom OpenAI Gym environment using HMM regime probabilities as state input.
* **`ppo_train_regime_rl.py`**: Trains a PPO agent using stable-baselines3 to learn optimal portfolio strategies based on regime-aware signals.
* **`ppo_rl_pipeline.py`**: Basic PPO agent with simple reward function.
* **`ppo_rl_stable.py`**: Final implementation with transaction cost modeling, volatility-adjusted reward, clipping, capital reset, and shock simulation.

---

### Output Summary

Each script generates the following output files:

* `ppo_rl_stable.py`:  
  - `ppo_advanced_vs_equal_returns.csv` — final evaluation metrics  
  - `ppo_vs_equal_portfolio_growth.png` — cumulative growth comparison  
* `sharpe_stress_analysis.py`:  
  - `sharpe_ratios_stress.csv`  
* `drawdown_analysis.py`:  
  - `max_drawdowns.csv`  
* `bootstrap_ci.py`:  
  - `bootstrap_cumulative_returns_ci.csv`  
* `rolling_sharpe_analysis.py`:  
  - `rolling_sharpe_ratios.csv`  
* `rolling_cagr_comparison_all_strategies.png`:  
  - Rolling CAGR chart for various strategies

---

## PPO Variant Outputs

### Trained Models

The following PPO models were trained using different ablation settings and saved under:

- `stable/ppo_rl_stable_seed0.zip` through `stable/ppo_rl_stable_seed4.zip`
- `nocost/nocost_seed0.zip` through `nocost/nocost_seed4.zip`
- `noreset/noreset_seed0.zip` through `noreset/noreset_seed4.zip`

### Generated Evaluation Files

- `ppo_vs_equal_portfolio_growth.png` — Portfolio growth comparison between PPO and equal-weight strategy
- `ppo_vs_equal_returns.csv` — Final log return series for PPO and baselines
- `ppo_vs_equal_returns_clipped.csv` — Clipped return series used for stress visualization
- `rolling_cagr_comparison_all_strategies.png` — Rolling CAGR comparison for Equal, Momentum, Sharpe-opt, and PPO
- `rolling_cagr_stress_overlay.png` — PPO CAGR with annotated financial stress years
- `KDECAGR.png` — Kernel density estimate of CAGR distributions across baseline strategies
- `SHAP.png` — SHAP values explaining PPO model’s allocation decisions

---

## Results

* **`analysis_results.md`**: Summarizes all results from traditional portfolio analysis.  
* **`results.md`**: Summarizes regime-aware Monte Carlo simulation, clustering quality, and RL-based outcomes.  
* **`rl_analysis_report.md`**: Detailed summary of the PPO reinforcement learning portfolio training, evaluation, ablation studies (`nocost`, `noreset`, `noclip`), statistical testing, and SHAP explainability.  
* **`ppo_full_pipeline.py`**: Single script for PPO training and evaluation across baseline and ablation variants using multi-seed reproducibility and evaluation tracking.


---

## Analysis Components

* Sharpe and Sortino ratio calculations
* Monte Carlo simulations with fixed and dynamic regimes
* PCA-based resilience scoring
* Portfolio optimization (Sharpe, Sortino)
* Factor attribution with Fama-French + Momentum
* Regime clustering with KMeans, GMM, and HMM
* Supervised regime prediction
* Reinforcement learning-based portfolio optimization
* Risk assessment: VaR, CVaR, and max drawdown
* Regime-aware training with PPO
* Evaluation of PPO against equal-weight and optimized portfolios
* Rolling CAGR analysis and stress testing
* PPO ablation variants: nocost, noclip, noreset
* SHAP explainability of learned PPO policies

---

---

## License

This project is licensed under the MIT License. See the `LICENSE` file for full details.

---

## Acknowledgments

This work builds upon publicly available financial data curated by Professor **Aswath Damodaran** of New York University (NYU), whose commitment to data transparency and academic openness continues to inspire.

Special thanks to the contributors of the following tools and libraries:

- [Stable-Baselines3](https://github.com/DLR-RM/stable-baselines3) for reinforcement learning agents
- [scikit-learn](https://scikit-learn.org/) and [XGBoost](https://xgboost.readthedocs.io/) for supervised regime classification
- [hmmlearn](https://hmmlearn.readthedocs.io/) and [pomegranate](https://github.com/jmschrei/pomegranate) for probabilistic regime modeling
- [matplotlib](https://matplotlib.org/) and [seaborn](https://seaborn.pydata.org/) for plotting
- NYU Center for Data Science for computational resources and academic environment

This project was completed as part of an academic exploration during the Master’s in Data Science program at **New York University**.
